# Code MCP Server
A Model Context Protocol (MCP) server written in TypeScript that provides tools for creating Go and Python microservices and modules. The server exposes `create-service` and `create-module` tools that generate complete project scaffolding from templates.

Always reference these instructions first and fallback to search or bash commands only when you encounter unexpected information that does not match the info here.

## Working Effectively

### Bootstrap and Build
- Install dependencies: `npm install` -- takes 8-10 seconds. NEVER CANCEL.
- Build TypeScript to JavaScript: `npm run build` -- takes 1-2 seconds. NEVER CANCEL.
- Run MCP server in development: `npm run dev` -- starts immediately, runs continuously. Use Ctrl+C to stop.
- Run compiled MCP server: `npm run start` -- starts immediately, runs continuously. Use Ctrl+C to stop.

### Development Commands
- Test service creation: `npm run dev:create-service` -- takes 1-2 seconds. NEVER CANCEL.
- Test module creation: `npm run dev:create-module` -- takes 1-2 seconds. NEVER CANCEL.

### Project Structure
Key directories and files:
- `src/mcp.ts` - Main MCP server with tool definitions
- `src/create-service.ts` - Service scaffolding logic
- `src/create-module.ts` - Module scaffolding logic  
- `src/templates/` - Go and Python service/module templates
- `src/language-config/` - Configuration for supported languages
- `scripts/` - Shell scripts for service creation automation
- `dist/` - Compiled JavaScript output (generated by build)

## Validation

### Build Validation
- ALWAYS run `npm install && npm run build` before making changes.
- Build succeeds without errors and generates `dist/` directory with compiled JS files.
- NEVER skip build validation - the project uses ES modules and specific import paths.

### Testing Service Creation
- ALWAYS test both Go and Python service creation after making changes.
- Go service creation workflow:
  1. Create test directory: `mkdir /tmp/test-service && cd /tmp/test-service`
  2. Copy required assets: `cp -r /path/to/repo/scripts . && cp -r /path/to/repo/src/templates . && cp -r /path/to/repo/src/language-config .`
  3. Test Go service: Create service with templates, run `go mod init`, `go mod tidy`, verify compilation
  4. Expected time: Service creation ~1 second, Go mod tidy ~75 seconds, Go build ~25 seconds. NEVER CANCEL.
- Python service creation: Verify templates generate proper Python project structure.

### MCP Server Validation  
- Start server: `npm run dev` or `npm run start`
- Server should start without errors and listen for MCP protocol messages on stdin/stdout
- Use Ctrl+C to stop gracefully

### Manual Testing Scenarios
- ALWAYS test complete service creation workflow after making template changes:
  1. Generate a new Go service with name "test-api"
  2. Generate a "user" module within the service  
  3. Initialize Go module: `go mod init test-api`
  4. Download dependencies: `go mod tidy` -- takes 60-90 seconds. NEVER CANCEL.
  5. Add missing dependencies: `go get github.com/google/uuid`
  6. Create minimal swagger docs: `mkdir -p docs/swagger && echo 'package swagger' > docs/swagger/docs.go`
  7. Build service: `go build -o test-service ./cmd/main.go` -- takes 20-30 seconds. NEVER CANCEL.
  8. Verify binary created and can start (will fail without database, which is expected)

## Common Tasks

### Adding New Templates
- Go templates: Add to `src/templates/templates-go/service/` or `src/templates/templates-go/module/`  
- Python templates: Add to `src/templates/templates-py/service/` or `src/templates/templates-py/module/`
- Update language config: Modify `src/language-config/go.json` or `src/language-config/py.json`
- Template variables: Use `{{SERVICE_NAME}}`, `{{MODULE_NAME}}`, `{{MODULE_NAME_UPPER}}` for replacements

### Fixing Import Issues
- The project uses ES modules (`"type": "module"` in package.json)
- ALWAYS use `.js` extensions in relative imports in TypeScript files
- Example: `import { createService } from "./create-service.js";`
- Rebuild after changing imports: `npm run build`

### Error: "Cannot find module" 
- Check import paths have `.js` extensions
- Verify file exists in `dist/` after building
- Ensure templates and language-config directories are accessible

## Configuration

### Key Files
- `package.json` - Project dependencies and npm scripts, ES module configuration
- `tsconfig.json` - TypeScript compilation settings, outputs to `dist/`
- `.gitignore` - Excludes `node_modules`, `dist`, build artifacts

### Template Variables
Available in all templates:
- `{{SERVICE_NAME}}` - Name of the service being created
- `{{MODULE_NAME}}` - Name of the module being created (lowercase)
- `{{MODULE_NAME_UPPER}}` - Module name with first letter capitalized

### Language Support
- **Go**: Full service and module scaffolding with Gin, GORM, Swagger
- **Python**: Basic service scaffolding with FastAPI structure
- Both languages support: database configuration, Docker setup, environment files

## Known Issues and Workarounds

### Go Service Dependencies
- Generated services require these Go modules: `gin-gonic/gin`, `gorm.io/gorm`, `gorm.io/driver/postgres`, `swaggo/gin-swagger`, `google/uuid`
- Always run `go mod tidy` after service creation to download dependencies
- Generated code expects PostgreSQL database - service will fail to start without it (this is expected behavior)

### Template Paths
- Templates must be copied to working directory for service creation to work
- Use relative paths `../scripts/`, `../templates/` when running outside repo directory
- Script copying logic in `create-service.ts` expects scripts in relative path

### MCP Protocol
- Server uses stdin/stdout for MCP communication
- Cannot be tested with standard CLI interactions
- Requires MCP-compatible client for full functionality testing

## Timing Expectations and Timeouts

### Critical: Never Cancel Operations
- **npm install**: 8-10 seconds
- **npm run build**: 1-2 seconds  
- **go mod tidy**: 60-90 seconds. NEVER CANCEL - downloads many dependencies
- **go build**: 20-30 seconds. NEVER CANCEL - compiles with all dependencies
- **Service startup**: Immediate but fails without database (expected)

### Recommended Timeouts
- npm operations: 30+ seconds
- Go operations: 120+ seconds  
- Template generation: 10+ seconds
- Always wait for completion - builds may appear to hang but are working

## Development Workflow

### Making Changes
1. Make code changes in `src/` directory
2. Run `npm run build` to compile TypeScript
3. Test with `npm run dev:create-service` or `npm run dev:create-module`
4. Validate by creating and building a complete service manually
5. Test MCP server starts: `npm run dev`

### Testing Templates
1. Modify templates in `src/templates/`
2. Update language config if needed
3. Create test service to verify template changes
4. Build and run generated service to ensure it compiles
5. Check all template variables are properly replaced

### Debugging Import Issues
1. Check console for "Cannot find module" errors
2. Verify imports use `.js` extensions in TypeScript files
3. Rebuild and check `dist/` directory structure
4. Test with `npm run dev` to use TypeScript directly